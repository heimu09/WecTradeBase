[{"start":{"activity_category":1,"activity":{"cell_id":"5977784f-2db7-423a-b19b-7090e1244228","code":8,"params":{"version":"4.0.0","variable_value":{"use_previous_step":false},"is_variable_global":true,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"script_id":"d49ad97a-e18d-450c-9d7a-da95631b734a","app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"studio_version":{"created":"9.0.3","updated":"9.0.3"},"paper_size":{"height":2797,"width":2000,"x":-50,"y":-55},"js_file_path":null,"username":null,"link_vertices":{"0":{"source_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","source_port":"exit","target_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","vertices":[{"x":692,"y":2448}]},"1":{"source_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","source_port":"exit","target_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","vertices":[{"x":692,"y":2448}]},"2":{"source_id":"bd32f25c-5159-4c3e-b200-4910af500528","source_port":"exit","target_id":"1c741502-cf19-467b-bec1-dace0a7ea5c7","vertices":[{"x":1712,"y":632}]},"3":{"source_id":"bd32f25c-5159-4c3e-b200-4910af500528","source_port":"exit","target_id":"1c741502-cf19-467b-bec1-dace0a7ea5c7","vertices":[{"x":1712,"y":632}]}},"project":{"name":"WecTradeBase","path":"C:\\Users\\User\\Documents\\WecTradeBase","main":"main.neek","settings":{"variables":[],"performanceSettings":{"automaticallyCreateLogForEachRun":false,"isStatusWindowEnabled":true},"browserSettings":{"useDefaultProfile":true,"useBrowser":"ie","customArgs":"","keepBrowserOpen":true},"doNotCloseWhileDebug":false,"microsoftExcelActivities":"generic","antiCaptcha":true}}}},"position":{"x":1472.8,"y":0},"next":{"exit":{"activity_category":6,"activity":{"cell_id":"1c741502-cf19-467b-bec1-dace0a7ea5c7","code":1,"params":{"version":"4.35.0","path":{"use_previous_step":false,"statement":"`${path_directory}\\\\access_data.xlsx`"},"json_value":{"use_previous_step":false},"sheet_name":{"value":"Data","use_previous_step":false},"row":{"use_previous_step":false},"column_map":{"use_previous_step":false},"dest_path":{"use_previous_step":false},"dest_sheet_name":{"use_previous_step":false},"headers_format":1,"comment":"Чтение информации аунтитификации","breakpoint":false,"deactivated":false,"from_row":{"use_previous_step":false},"to_row":{"use_previous_step":false},"from_column":{"use_previous_step":false},"to_column":{"use_previous_step":false},"range":{"use_previous_step":false},"cell_value":{"use_previous_step":false},"macros_path":{"use_previous_step":false},"macros_function_name":{"use_previous_step":false},"macros_param":{"use_previous_step":false},"insert_or_delete":"insert","column_count":{"use_previous_step":false},"sort_range":{"use_previous_step":false},"sort_columns":{"use_previous_step":false},"sort_direction":0}},"position":{"x":1362.8,"y":110},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"7b51fb32-9e4a-43a4-88a3-4a3fdf4ea5bb","code":3,"params":{"version":"9.0.3","variable_name":"access_data","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись информации аунтитификации в переменную","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":892.8,"y":221.2},"next":{"exit":{"activity_category":10,"activity":{"cell_id":"641f2461-b517-4d89-b4c6-19a8bfb051c1","code":1,"params":{"version":"4.35.0","url":{"value":"https://wectradekz.amocrm.ru/api/v4/leads?order[updated_at]=desc&filter[pipeline_id]=5760214&with=contacts,catalog_elements&limit=250","use_previous_step":false},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запросс на api amocrm на получение последних 250 сделок","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":892.8,"y":345.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"4425675d-6d4c-4249-b6f7-cccc53dfadb8","code":3,"params":{"version":"9.0.3","variable_name":"data","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Созраняем последнии 250 сделок в переменнуюTransactions","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":555.3,"y":456.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"08e2a835-23e9-456f-8e1f-95fbb9484418","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"let result = []\r\ndata = JSON.parse(data)['_embedded']['leads'];\r\n\r\nfor (let i = 0; i < data.length; i++){\r\n    if(data[i][\"status_id\"] === 50548993){\r\n        result.push(data[i]);\r\n    }\r\n}\r\n\r\ndata = result"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Выборка только тех сделок что находятся в стадии заказ передан логисту","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_2.js","username":null}},"position":{"x":555.3,"y":567.6},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"49788722-946b-404e-a388-d6a61a9798ce","code":3,"params":{"version":"4.35.0","variable_name":"result","variable_value":{"use_previous_step":false,"statement":"[]"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Переменнаю которая будет хранить итоговый вид всех необходимых нам данных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":555.3,"y":717.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"d7fc3fb3-cb27-44c7-94e4-8e31db25d297","code":3,"params":{"version":"4.35.0","variable_name":"len","variable_value":{"use_previous_step":false,"statement":"data.length"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Длинна результата запроса для итерации по нему","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":555.3,"y":860.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":{"leftHand":{"type":"variable","value":"len"},"rightHand":{"type":"number","value":"0"},"operator":{"type":"notEqual"}},"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Условие цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":555.3,"y":1016.4000000000001},"next":{"yes":{"activity_category":1,"activity":{"cell_id":"8c0d32c4-752b-42d8-a9a8-505783514f47","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":"data[len-1]['_embedded']['contacts'].length > 0","basicCondition":null,"conditionType":"advanced","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Если контакты есть","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":175,"y":1140.4},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"6962ab47-b0b1-45d7-a5ef-a6a0a08930fc","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/contacts/\" + data[len-1]['_embedded']['contacts'][0]['id']"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":false,"statement":""},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запрос на получение контактов с сделки","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":67.5,"y":1264.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"7f3072aa-b09e-47b4-bd35-371e766b6c9c","code":3,"params":{"version":"9.0.3","variable_name":"contact","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись реультата запроса в переменную","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":175,"y":1375.6000000000001},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"168ad6fb-2259-4e96-a922-a840f26e9fce","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":"data[len-1]['_embedded']['companies'].length > 0","basicCondition":null,"conditionType":"advanced","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Если компания есть","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":175,"y":1486.8000000000002},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"76367bb1-f7fc-4a84-a712-3b3a960084de","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/companies/\" + data[len-1]['_embedded']['companies'][0]['id']"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Получение компании","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":126.89999999999996,"y":1610.8000000000002},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"d0fa5f5c-e5a5-4855-b400-91374bdb0cd8","code":3,"params":{"version":"9.0.3","variable_name":"companies","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Записываем результат","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":175,"y":1709.2000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"16c023df-c720-41ad-979a-2ce4c2625d22","code":3,"params":{"version":"4.35.0","variable_name":"products_len","variable_value":{"use_previous_step":false,"statement":"data[len-1]['_embedded']['catalog_elements'].length"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Количество товаров сделки","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":175,"y":1820.4000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"5c9df5e0-e5b7-4e00-b26a-60256db5bca2","code":3,"params":{"version":"4.35.0","variable_name":"products","variable_value":{"use_previous_step":false,"statement":"[]"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Переменная в котором будет храниться итоговый вид товаров","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":175,"y":1944.4000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"bf8cd079-7b70-428b-8bb2-2160ae183ff8","code":1,"params":{"version":"9.0.3","variable_value":{"use_previous_step":false},"is_variable_global":true,"basicCondition":{"leftHand":{"type":"variable","value":"products_len"},"rightHand":{"type":"number","value":"0"},"operator":{"type":"greater"}},"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Цикл для получения информации о каждом продукте отдельно","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":175,"y":2055.6000000000004},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"3cf3cf58-6de0-4c73-bedf-f5b6463dae3d","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/catalogs/5975/elements/\" + data[len-1]['_embedded']['catalog_elements'][products_len-1][\"id\"]"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запрос для получения всей информации продукта","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":0,"y":2198.8000000000006},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"4b3e5e81-2d46-4121-a6a4-9431913721ee","code":3,"params":{"version":"9.0.3","variable_name":"product_info","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись результата выполнения запроса","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":0,"y":2329.2000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"84647a17-cfc8-4c70-b4c9-840980be0e5c","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"product_info = JSON.parse(product_info)\r\n\r\nlet product = {\r\n    \"Артикул\": null,\r\n    \"Название\": product_info[\"name\"],\r\n    \"Количество\": data[len-1]['_embedded']['catalog_elements'][products_len-1][\"metadata\"][\"quantity\"],\r\n    \"Цена\": 0\r\n}\r\n\r\nfor (let i = 0; i < product_info['custom_fields_values'].length; i++){\r\n    if(product_info['custom_fields_values'][i]['field_name'] === \"Артикул\"){\r\n        product['Артикул'] = product_info['custom_fields_values'][i]['values'][0]['value'];\r\n    }else{\r\n        if(product_info['custom_fields_values'][i]['field_id'] == data[len-1]['_embedded']['catalog_elements'][products_len-1][\"metadata\"]['price_id']){\r\n            product['Цена'] = product_info['custom_fields_values'][i]['values'][0]['value'];\r\n        }\r\n    }\r\n}\r\n\r\nproducts.push(product)\r\n"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Приводим информацию о продукте в нормальный вид","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_3.js","username":null}},"position":{"x":0,"y":2453.2000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"57ee4a33-793c-4423-bca8-a46f6e0d9bf7","code":3,"params":{"version":"4.35.0","variable_name":"products_len","variable_value":{"use_previous_step":false,"statement":"products_len - 1"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Меняем длинну для проверки условия цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":100.29999999999995,"y":2602.8},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit"]}}}}}}}}},"no":{"activity_category":1,"activity":{"cell_id":"9387a1b4-a52f-409e-97ff-b5a8e1a643cc","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"let contact_info = {\r\n    'id': data[len-1]['id'],\r\n    'Телефон': null,\r\n    'Адрес доставки': null,\r\n    'Город': null,\r\n    'Примечание': null,\r\n    'Примечание по доставке': null,\r\n    'Компания': null,\r\n    'Теги': [],\r\n    'Дата доставки': null,\r\n    'Категория лида': null,\r\n    'Номер заказа в 1С': null,\r\n    'Товары': null,\r\n    'Дата реализации': null\r\n    };\r\n\r\ncontact = JSON.parse(contact);\r\n\r\nfor (let i = 0; i < data[len-1]['_embedded']['tags'].length; i++){\r\n    contact_info['Теги'].push(data[len-1]['_embedded']['tags'][i]['name']);\r\n}\r\n\r\nfor (let i = 0; i < contact['custom_fields_values'].length; i++){\r\n    if(contact['custom_fields_values'][i]['field_name'] === \"Телефон\"){\r\n        contact_info['Телефон'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n    }else{\r\n        if(contact['custom_fields_values'][i]['field_name'] === \"Адрес доставки\"){\r\n            contact_info['Адрес доставки'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n        }else{\r\n            if(contact['custom_fields_values'][i]['field_name'] === \"Город\"){\r\n                if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Астана\"){\r\n                    contact_info['Город'] = \"Нур-Султан\";\r\n                }else{\r\n                    if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Алматы\"){\r\n                        contact_info['Город'] = \"Алмата\"\r\n                    }\r\n                    else{\r\n                        if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Караганда\"){\r\n                            for(let i = 0; i < contact_info['Теги'].length; i++){\r\n                                if (contact_info['Теги'][i] == \"караганда2смена\"){\r\n                                    contact_info['Город'] = \"Караганда 2\";\r\n                                    break;\r\n                                }\r\n                                else{\r\n                                    contact_info['Город'] = \"Караганда 1\";\r\n                                    break;\r\n                                }\r\n                            }\r\n                            if(contact_info['Теги'].length == 0){\r\n                                contact_info['Город'] = \"Караганда 1\";\r\n                            }\r\n                        }\r\n                        else{\r\n                            contact_info['Город'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n                        }\r\n                    }\r\n                }\r\n            }else{\r\n                if(contact['custom_fields_values'][i]['field_name'] === \"Примечание\"){\r\n                    contact_info['Примечание'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfor (let i = 0; i < data[len-1]['custom_fields_values'].length; i++){\r\n    if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Дата доставки\"){\r\n            let unix_timestamp = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n            let date = new Date(unix_timestamp * 1000);\r\n            let today = new Date()\r\n\r\n            if (date > today){\r\n                contact_info['Дата реализации'] = today.toLocaleDateString();\r\n            }else{\r\n                contact_info['Дата реализации'] = date.toLocaleDateString();\r\n            }\r\n\r\n            contact_info['Дата доставки'] = date.toLocaleDateString();\r\n        }else{\r\n            if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Категория лида\"){\r\n                contact_info['Категория лида'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n            }else{\r\n                if (data[len-1]['custom_fields_values'][i]['field_name'] === \"Номер заказа в 1c\"){\r\n                    contact_info['Номер заказа в 1С'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n                }else{\r\n                    if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Примечание по доставке\"){\r\n                        contact_info['Примечание по доставке'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n}\r\n\r\nif (companies !== false){\r\n    companies = JSON.parse(companies)\r\n    contact_info[\"Компания\"] = companies[\"name\"]\r\n}\r\n\r\nif(products.length == 0){}\r\nelse{\r\n    contact_info[\"Товары\"] = products\r\n\r\n    result.push(contact_info)}\r\n"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Код для приведения всей информации в нормальный виды","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_4.js","username":null}},"position":{"x":350,"y":2179.6000000000004},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","code":3,"params":{"version":"4.35.0","variable_name":"len","variable_value":{"use_previous_step":false,"statement":"len - 1"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Меняем длинну для проверки условия цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":350,"y":2335.6000000000004},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit"]}}},"error":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit","next","no","next","exit"]}}}}}}}}}}}}},"no":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit"]}}}}}}},"no":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit"]}}},"no":{"activity_category":1,"activity":{"cell_id":"f5bd6c59-edb4-4965-aff5-b57c3913aef0","code":3,"params":{"version":"4.35.0","variable_name":"to_1c_data","variable_value":{"use_previous_step":false,"statement":"result"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":771,"y":1168},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"81072683-ee7c-4bc1-8bb1-565e878c224e","code":3,"params":{"version":"4.35.0","variable_name":"to_1c_access_data","variable_value":{"use_previous_step":false,"statement":"access_data"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":726.6,"y":1285.6},"next":{}}}}}}}}}}}}}},"error":{"activity_category":10,"activity":{"cell_id":"d05f57e8-728e-455e-8582-6475bab38919","code":1,"params":{"version":"4.35.0","url":{"value":"https://wectradekz.amocrm.ru/oauth2/access_token","use_previous_step":false},"request_method":{"value":"post","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":false,"statement":"{\r\n  \"client_id\": \"0ef8113b-d670-4ef1-8805-2d68884be26a\",\r\n  \"client_secret\": \"dh1sK3UAv8hEvhWJfsA5pNR2DDvyg0ToOhkWZAgKhBMAk2bMb2K3IYbUOJEOUZcP\",\r\n  \"grant_type\": \"refresh_token\",\r\n  \"refresh_token\": access_data[\"Data\"][0][\"refresh_token\"],\r\n  \"redirect_uri\": \"https://wectradekz.amocrm.ru\"\r\n}"},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"value":"","use_previous_step":false},"file_key":{"value":"","use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":""},"comment":"Запрос на востонавление токенов","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":905.3,"y":456.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"bfbae444-1cfc-4820-a759-383e90406b35","code":3,"params":{"version":"9.0.3","variable_name":"access_data","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись новой информации аунтитификации в переменную","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null}},"position":{"x":905.3,"y":580.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"1f7b21e5-4e5d-415c-aa23-3a7437fa1664","code":3,"params":{"version":"4.35.0","variable_name":"access_token","variable_value":{"use_previous_step":false,"statement":""},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Токен авторизации используется во всех телах запросов, повторно сгенерированная","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":905.3,"y":717.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"222c6d98-29ac-444e-b380-a51b3129a1d7","code":3,"params":{"version":"4.35.0","variable_name":"refresh_token","variable_value":{"use_previous_step":false,"statement":""},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Токен для востановления access токена по истечению срока, повторно сгенерированная","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":905.3,"y":854},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"a7ac1aaf-be1b-4cba-a9a4-375f291985ca","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"access_token = access_data[\"access_token\"];\r\nrefresh_token = access_data[\"refresh_token\"];"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Перезапись переменных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_1.js","username":null}},"position":{"x":905.3,"y":997.2000000000002},"next":{"exit":{"activity_category":6,"activity":{"cell_id":"bd32f25c-5159-4c3e-b200-4910af500528","code":2,"params":{"version":"4.35.0","path":{"use_previous_step":false,"statement":"`${path_directory}\\\\access_data.xlsx`"},"json_value":{"use_previous_step":false,"statement":"{\"Data\": [\r\n    {\r\n        \"refresh_token\": refresh_token,\r\n        \"access_token\": access_token\r\n    }\r\n]}"},"sheet_name":{"use_previous_step":false},"row":{"use_previous_step":false},"column_map":{"use_previous_step":false},"dest_path":{"use_previous_step":false},"dest_sheet_name":{"use_previous_step":false},"headers_format":0,"comment":"Запись авторизационных данных","breakpoint":false,"deactivated":false,"from_row":{"use_previous_step":false},"to_row":{"use_previous_step":false},"from_column":{"use_previous_step":false},"to_column":{"use_previous_step":false},"range":{"use_previous_step":false},"cell_value":{"use_previous_step":false},"macros_path":{"use_previous_step":false},"macros_function_name":{"use_previous_step":false},"macros_param":{"use_previous_step":false},"insert_or_delete":"insert","column_count":{"use_previous_step":false},"sort_range":{"use_previous_step":false},"sort_columns":{"use_previous_step":false},"sort_direction":0}},"position":{"x":1282.8,"y":1153.2},"next":{"exit":{"$type":"ref","value":["start-0","next","exit"]}}}}}}}}}}}}}}}}},"error":{"activity_category":1,"activity":{"cell_id":"5bf3b6fc-9e0f-413a-9caf-e7658709f8d5","code":3,"params":{"version":"4.35.0","variable_name":"access_token","variable_value":{"use_previous_step":false,"statement":"\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjRmOTM4N2NlYmZiYTA5MDdiOGVhNGUwNGE0YWMwZmI3MmQyYTI3M2NmMzM5NzYyNDcyNjQ2Y2UzODZlZmI2NGIyYmY4MGUwYmI3Y2I1YzU2In0.eyJhdWQiOiIwZWY4MTEzYi1kNjcwLTRlZjEtODgwNS0yZDY4ODg0YmUyNmEiLCJqdGkiOiI0ZjkzODdjZWJmYmEwOTA3YjhlYTRlMDRhNGFjMGZiNzJkMmEyNzNjZjMzOTc2MjQ3MjY0NmNlMzg2ZWZiNjRiMmJmODBlMGJiN2NiNWM1NiIsImlhdCI6MTY3NTE1MjA2NywibmJmIjoxNjc1MTUyMDY3LCJleHAiOjE2NzUyMzg0NjcsInN1YiI6Ijg0MDA5MTYiLCJhY2NvdW50X2lkIjozMDMwMTQ5OCwiYmFzZV9kb21haW4iOiJhbW9jcm0ucnUiLCJzY29wZXMiOlsicHVzaF9ub3RpZmljYXRpb25zIiwiZmlsZXMiLCJjcm0iLCJmaWxlc19kZWxldGUiLCJub3RpZmljYXRpb25zIl19.VBjuQRZA6ElCcYwQNz3eoUDCjgaGlkt16XEXoyCB4aET1NCzUVB9Srl5Kg3MI2DzxLQ9wS8QU6RKKtyrYCosMHO4_LJdwfN0SWJGFESGYSbU4APkNG6_UL0m_94jlKUZquJmPYLOr6yr-m6TlB9VoZ78mHh1Cc_ODgUW6EaLtkp3DmZVuL2qBNXhS86T7uHJ8iwVuQjJFWvedt7xi5yrvxg1wf7Ej2g9KcT-ipgc_MO_GUvqLZfGDwJmZ1Byx4h5dFrEP__F0fkmsSAK88n1jmk4dhkIbQLvDl4b-w34Ad3COlBI65iJWS84kVWSyz-jeGaY07jTMRgW9c6_JN-jPw\""},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":1255.3,"y":841.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"2028f56f-c9e6-435c-bf22-3b1db35bb82c","code":3,"params":{"version":"4.35.0","variable_name":"refresh_token","variable_value":{"use_previous_step":false,"statement":"\"def502009af06727bfc5a983a8c7630f52b7581b562b09534053a9cb9a626c5cdf5d7a3a1ca1081c2052e498e1e92442fe6d6716e56c67b5d8c5e7dcbed202ff2bec779c5ef6b7c19829f9fb9c44a27f893f022becb2bdeb7d0ba301d7556f21107a7bbb3b7e3e45e3cac6f6c184cb5272431d40a17d79e303c2b63cfa637efefe50edeb15bb16912c5ecf975bc9591fdf5192532c1ff1d5aefe7251c025600dd62cda031c0e3b0398e8f2124e514cb186d5ee978eba2bfd2934428229e61242c80fe3965e5c93e53a0106b503df095c6b9b41a061e8ee2c9a75c19bbb244fc600b302d9fd983ac1e17816112c28c2aeff3ada11deac61cebf03c8c1e6c44fbef2caab23b38e9219be72843f140e6397f579cc25d0ba2e7d87a13066944383124709e106d12cca0309b841d86f9c47f05dab8e8f4498bcc7626f70de79c48dfbf4b7f8578e1807fec91b0b0497123701e567797c314641c03ed391acc1e619b83f6744a95fd88bdf3224f3ef6629d6751a59a2bfbd72577ed57d3933c113d8cb671c66e4cb3dd1bad2ed45bdeed52d48efacbbfbb60937ca457517ca75dfe584ffd2ac4b25b8b69097bc2f9cd8de4b237fa0131703a233e4eaaf78e3486273393d41a1f69d4144cde9c228a90ca18013b8741964c715c86e61078ebae734174473\""},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null}},"position":{"x":1255.3,"y":990.8000000000002},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","error","next","exit","next","exit","next","exit","next","exit","next","exit"]}}}}}}}}}}]