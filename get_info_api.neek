[{"start":{"activity_category":1,"activity":{"cell_id":"5977784f-2db7-423a-b19b-7090e1244228","code":8,"params":{"version":"4.0.0","variable_value":{"use_previous_step":false},"is_variable_global":true,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"script_id":"d49ad97a-e18d-450c-9d7a-da95631b734a","app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"studio_version":{"created":"9.0.3","updated":"9.2.11"},"paper_size":{"height":3703.5555572509766,"width":2222.2223052978516,"x":-55.55555725097656,"y":-55.55555725097656},"js_file_path":null,"username":null,"timeout":0,"link_vertices":{"0":{"source_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","source_port":"exit","target_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","vertices":[{"x":1464,"y":1498}]},"1":{"source_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","source_port":"exit","target_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","vertices":[{"x":1464,"y":1498}]},"2":{"source_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","source_port":"exit","target_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","vertices":[{"x":1464,"y":1498}]}},"project":{"name":"WecTradeBase","path":"C:\\Users\\User\\Documents\\А-Бизнес\\Backaps\\WecTradeBase","main":"main.neek","settings":{"variables":[],"performanceSettings":{"automaticallyCreateLogForEachRun":false,"isStatusWindowEnabled":true},"browserSettings":{"useDefaultProfile":true,"useBrowser":"ie","customArgs":"","keepBrowserOpen":true},"doNotCloseWhileDebug":false,"microsoftExcelActivities":"generic","antiCaptcha":true}}}},"position":{"x":1307.4,"y":0},"next":{"exit":{"activity_category":6,"activity":{"cell_id":"1c741502-cf19-467b-bec1-dace0a7ea5c7","code":1,"params":{"version":"4.35.0","path":{"use_previous_step":false,"statement":"`${path_directory}\\\\access_data.xlsx`"},"json_value":{"use_previous_step":false},"sheet_name":{"value":"Data","use_previous_step":false},"row":{"use_previous_step":false},"column_map":{"use_previous_step":false},"dest_path":{"use_previous_step":false},"dest_sheet_name":{"use_previous_step":false},"headers_format":1,"comment":"Чтение информации аунтитификации","breakpoint":false,"deactivated":false,"from_row":{"use_previous_step":false},"to_row":{"use_previous_step":false},"from_column":{"use_previous_step":false},"to_column":{"use_previous_step":false},"range":{"use_previous_step":false},"cell_value":{"use_previous_step":false},"macros_path":{"use_previous_step":false},"macros_function_name":{"use_previous_step":false},"macros_param":{"use_previous_step":false},"insert_or_delete":"insert","column_count":{"use_previous_step":false},"sort_range":{"use_previous_step":false},"sort_columns":{"use_previous_step":false},"sort_direction":0}},"position":{"x":1197.4,"y":110},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"7b51fb32-9e4a-43a4-88a3-4a3fdf4ea5bb","code":3,"params":{"version":"9.0.3","variable_name":"access_data","variable_value":{"use_previous_step":true},"is_variable_global":true,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись информации аунтитификации в переменную","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1197.4,"y":221.2},"next":{"exit":{"activity_category":10,"activity":{"cell_id":"641f2461-b517-4d89-b4c6-19a8bfb051c1","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"leads_url"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запросс на api amocrm на получение последних 250 сделок","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":1195,"y":345},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"4425675d-6d4c-4249-b6f7-cccc53dfadb8","code":3,"params":{"version":"9.0.3","variable_name":"data","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Созраняем последнии 250 сделок в переменнуюTransactions","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":982.4000000000001,"y":456.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"7fbe0782-c74f-45e1-b795-3797ebc1db4b","code":3,"params":{"version":"4.35.0","variable_name":"amo_response","variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1036.4,"y":567.6},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"08e2a835-23e9-456f-8e1f-95fbb9484418","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"let result = []\r\namo_response = JSON.parse(data)\r\ndata = JSON.parse(data)['_embedded']['leads'];\r\n\r\nfor (let i = 0; i < data.length; i++){\r\n    if(data[i][\"status_id\"] === 50548993){\r\n        result.push(data[i]);\r\n    }\r\n}\r\n\r\ndata = result"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Выборка только тех сделок что находятся в стадии заказ передан логисту","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_2.js","username":null,"timeout":0}},"position":{"x":982.4000000000001,"y":653.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"a55f0403-9cfe-42e2-a32f-6ac1f27b87ef","code":3,"params":{"version":"4.35.0","variable_name":"next_url","variable_value":{"use_previous_step":false,"statement":"``"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1055.6000000000001,"y":802.8000000000001},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"4a47d1ac-a758-4726-83bd-0a2ee3eabf66","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"next_url = amo_response['_links']['next']['href'];"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_5.js","username":null,"timeout":0}},"position":{"x":982.4000000000001,"y":888.4000000000001},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"bbb9b504-a147-473a-b77b-40493bd309ae","code":3,"params":{"version":"4.35.0","variable_name":"is_next_url","variable_value":{"use_previous_step":false,"statement":"true"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":855.2,"y":1085.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"49788722-946b-404e-a388-d6a61a9798ce","code":3,"params":{"version":"4.35.0","variable_name":"result","variable_value":{"use_previous_step":false,"statement":"[]"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Переменнаю которая будет хранить итоговый вид всех необходимых нам данных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":982.4000000000001,"y":1170.8},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"d7fc3fb3-cb27-44c7-94e4-8e31db25d297","code":3,"params":{"version":"4.35.0","variable_name":"len","variable_value":{"use_previous_step":false,"statement":"data.length"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Длинна результата запроса для итерации по нему","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":982.4000000000001,"y":1294.8},"next":{"exit":{"activity_category":2,"activity":{"cell_id":"bcc24ca6-6bd9-4c4a-9caf-a914e6ee853e","code":1,"params":{"version":"9.2.11","path":{"value":"c:\\tmp\\ElectroNeek_log.txt","use_previous_step":false},"content":{"use_previous_step":false,"statement":"new Date().toISOString()+\"\\n\"+\"len=\"+len+\"\\n\""},"copy_from":{"use_previous_step":false},"move_to":{"use_previous_step":false},"comment":null,"breakpoint":false,"is_replace_existing":true}},"position":{"x":1432.3333740234375,"y":1306.6666870117188},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"b8d1f306-b827-41b3-ace3-d15664f3779f","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":{"leftHand":{"type":"variable","value":"len"},"rightHand":{"type":"number","value":"0"},"operator":{"type":"notEqual"}},"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Условие цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":985,"y":1418},"next":{"yes":{"activity_category":1,"activity":{"cell_id":"8c0d32c4-752b-42d8-a9a8-505783514f47","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":"data[len-1]['_embedded']['contacts'].length > 0","basicCondition":null,"conditionType":"advanced","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Если контакты есть","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":574,"y":1509},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"6962ab47-b0b1-45d7-a5ef-a6a0a08930fc","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/contacts/\" + data[len-1]['_embedded']['contacts'][0]['id']"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":false,"statement":""},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запрос на получение контактов с сделки","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":1089,"y":1692},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"7f3072aa-b09e-47b4-bd35-371e766b6c9c","code":3,"params":{"version":"9.0.3","variable_name":"contact","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись реультата запроса в переменную","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":1739.6000000000001},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"168ad6fb-2259-4e96-a922-a840f26e9fce","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":"data[len-1]['_embedded']['companies'].length > 0","basicCondition":null,"conditionType":"advanced","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Если компания есть","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":1850.8000000000002},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"76367bb1-f7fc-4a84-a712-3b3a960084de","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/companies/\" + data[len-1]['_embedded']['companies'][0]['id']"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Получение компании","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":329.29999999999995,"y":1974.8000000000002},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"d0fa5f5c-e5a5-4855-b400-91374bdb0cd8","code":3,"params":{"version":"9.0.3","variable_name":"companies","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Записываем результат","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":2073.2000000000003},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"16c023df-c720-41ad-979a-2ce4c2625d22","code":3,"params":{"version":"4.35.0","variable_name":"products_len","variable_value":{"use_previous_step":false,"statement":"data[len-1]['_embedded']['catalog_elements'].length"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Количество товаров сделки","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":2184.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"5c9df5e0-e5b7-4e00-b26a-60256db5bca2","code":3,"params":{"version":"4.35.0","variable_name":"products","variable_value":{"use_previous_step":false,"statement":"[]"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Переменная в котором будет храниться итоговый вид товаров","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":2308.4},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"bf8cd079-7b70-428b-8bb2-2160ae183ff8","code":1,"params":{"version":"9.0.3","variable_value":{"use_previous_step":false},"is_variable_global":true,"basicCondition":{"leftHand":{"type":"variable","value":"products_len"},"rightHand":{"type":"number","value":"0"},"operator":{"type":"greater"}},"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Цикл для получения информации о каждом продукте отдельно","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":402.5,"y":2419.6},"next":{"yes":{"activity_category":10,"activity":{"cell_id":"3cf3cf58-6de0-4c73-bedf-f5b6463dae3d","code":1,"params":{"version":"4.35.0","url":{"use_previous_step":false,"statement":"\"https://wectradekz.amocrm.ru/api/v4/catalogs/5975/elements/\" + data[len-1]['_embedded']['catalog_elements'][products_len-1][\"id\"]"},"request_method":{"value":"get","use_previous_step":false},"query_params":{"use_previous_step":true},"body_params":{"use_previous_step":true},"basic_auth_username":"","basic_auth_password":"","token":{"value":null,"use_previous_step":false},"file":{"use_previous_step":false},"file_key":{"use_previous_step":false},"custom_header":{"use_previous_step":false,"statement":"{\r\n    \"Authorization\": \"Bearer \" + access_data[\"Data\"][0][\"access_token\"]\r\n}"},"comment":"Запрос для получения всей информации продукта","breakpoint":false,"deactivated":false,"login":null,"add_certificate":false,"certificate":null,"authorization_url":{"use_previous_step":false},"access_token_url":{"use_previous_step":false},"client_id":{"use_previous_step":false},"client_secret":{"use_previous_step":false},"access_token_scope":{"use_previous_step":false},"access_token_state":{"use_previous_step":false}}},"position":{"x":54.89999999999998,"y":2562.8},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"4b3e5e81-2d46-4121-a6a4-9431913721ee","code":3,"params":{"version":"9.0.3","variable_name":"product_info","variable_value":{"use_previous_step":true},"is_variable_global":false,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"use_previous_step":false},"comment":"Запись результата выполнения запроса","command":{"use_previous_step":false},"breakpoint":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"app_title":null,"launch_params":null,"password":null,"iterator_source":{"use_previous_step":false},"js_file_path":null,"username":null,"timeout":0}},"position":{"x":0,"y":2693.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"0e4ec4ec-e896-4a98-9fea-1ddfcc7f764f","code":14,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"value":"","use_previous_step":false},"log_message":{"use_previous_step":true},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":73.2,"y":2817.2},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"84647a17-cfc8-4c70-b4c9-840980be0e5c","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"product_info = JSON.parse(product_info)\r\n\r\nlet product = {\r\n    \"Артикул\": null,\r\n    \"Название\": product_info[\"name\"],\r\n    \"Количество\": data[len-1]['_embedded']['catalog_elements'][products_len-1][\"metadata\"][\"quantity\"],\r\n    \"Цена\": 0\r\n}\r\n\r\nfor (let i = 0; i < product_info['custom_fields_values'].length; i++){\r\n    if(product_info['custom_fields_values'][i]['field_name'] === \"Артикул\"){\r\n        product['Артикул'] = product_info['custom_fields_values'][i]['values'][0]['value'];\r\n    }else{\r\n        if(product_info['custom_fields_values'][i]['field_id'] == data[len-1]['_embedded']['catalog_elements'][products_len-1][\"metadata\"]['price_id']){\r\n            product['Цена'] = product_info['custom_fields_values'][i]['values'][0]['value'];\r\n        }\r\n    }\r\n}\r\n\r\nproducts.push(product)\r\n"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Приводим информацию о продукте в нормальный вид","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_3.js","username":null,"timeout":0}},"position":{"x":0,"y":2903},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"57ee4a33-793c-4423-bca8-a46f6e0d9bf7","code":3,"params":{"version":"4.35.0","variable_name":"products_len","variable_value":{"use_previous_step":false,"statement":"products_len - 1"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Меняем длинну для проверки условия цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":282.5,"y":3052.3999999999996},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit"]}}},"error":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit"]}}}}}}},"error":{"activity_category":1,"activity":{"cell_id":"7554acb7-49aa-4106-8fe2-bfa1a4a173f3","code":7,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":"update_access_data.neek","comment":"Обновление аунтитификационных данных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":350,"y":2699.6},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit","next","yes"]}}}}},"no":{"activity_category":1,"activity":{"cell_id":"9387a1b4-a52f-409e-97ff-b5a8e1a643cc","code":12,"params":{"version":"4.35.0","variable_name":"$previous_result$","variable_value":{"use_previous_step":false,"statement":"let contact_info = {\r\n    'id': data[len-1]['id'],\r\n    'Телефон': null,\r\n    'Адрес доставки': null,\r\n    'Город': null,\r\n    'Примечание': null,\r\n    'Примечание по доставке': null,\r\n    'Компания': null,\r\n    'Теги': [],\r\n    'Дата доставки': null,\r\n    'Категория лида': null,\r\n    'Номер заказа в 1С': null,\r\n    'Товары': null,\r\n    'Дата реализации': null\r\n    };\r\n\r\ncontact = JSON.parse(contact);\r\n\r\nfor (let i = 0; i < data[len-1]['_embedded']['tags'].length; i++){\r\n    contact_info['Теги'].push(data[len-1]['_embedded']['tags'][i]['name']);\r\n}\r\n\r\nfor (let i = 0; i < contact['custom_fields_values'].length; i++){\r\n    if(contact['custom_fields_values'][i]['field_name'] === \"Телефон\"){\r\n        contact_info['Телефон'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n    }else{\r\n        if(contact['custom_fields_values'][i]['field_name'] === \"Адрес доставки\"){\r\n            contact_info['Адрес доставки'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n        }else{\r\n            if(contact['custom_fields_values'][i]['field_name'] === \"Город\"){\r\n                if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Астана\"){\r\n                    contact_info['Город'] = \"Нур-Султан\";\r\n                }else{\r\n                    if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Алматы\"){\r\n                        contact_info['Город'] = \"Алмата\"\r\n                    }\r\n                    else{\r\n                        if(contact['custom_fields_values'][i]['values'][0]['value'] === \"Караганда\"){\r\n                            for(let i = 0; i < contact_info['Теги'].length; i++){\r\n                                if (contact_info['Теги'][i] == \"караганда2смена\"){\r\n                                    contact_info['Город'] = \"Караганда 2\";\r\n                                    break;\r\n                                }\r\n                                else{\r\n                                    contact_info['Город'] = \"Караганда 1\";\r\n                                }\r\n                            }\r\n                            if(contact_info['Теги'].length == 0){\r\n                                contact_info['Город'] = \"Караганда 1\";\r\n                            }\r\n                        }\r\n                        else{\r\n                            contact_info['Город'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n                        }\r\n                    }\r\n                }\r\n            }else{\r\n                if(contact['custom_fields_values'][i]['field_name'] === \"Примечание\"){\r\n                    contact_info['Примечание'] = contact['custom_fields_values'][i]['values'][0]['value'];\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfor (let i = 0; i < data[len-1]['custom_fields_values'].length; i++){\r\n    if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Дата доставки\"){\r\n            let unix_timestamp = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n            let date = new Date(unix_timestamp * 1000);\r\n            let today = new Date()\r\n\r\n            if (date > today){\r\n                contact_info['Дата реализации'] = today.toLocaleDateString();\r\n            }else{\r\n                contact_info['Дата реализации'] = date.toLocaleDateString();\r\n            }\r\n\r\n            contact_info['Дата доставки'] = date.toLocaleDateString();\r\n        }else{\r\n            if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Категория лида\"){\r\n                contact_info['Категория лида'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n            }else{\r\n                if (data[len-1]['custom_fields_values'][i]['field_name'] === \"Номер заказа в 1c\"){\r\n                    contact_info['Номер заказа в 1С'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n                }else{\r\n                    if(data[len-1]['custom_fields_values'][i]['field_name'] === \"Примечание по доставке\"){\r\n                        contact_info['Примечание по доставке'] = data[len-1]['custom_fields_values'][i]['values'][0]['value'];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n}\r\n\r\nif (companies !== false){\r\n    companies = JSON.parse(companies)\r\n    contact_info[\"Компания\"] = companies[\"name\"]\r\n}\r\n\r\nif(products.length == 0 || contact_info['Номер заказа в 1С'] != null){\r\n    result = []\r\n}\r\nelse{\r\n    contact_info[\"Товары\"] = products\r\n\r\n    result = [contact_info]}\r\n"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Код для приведения всей информации в нормальный виды","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":"get_info_api_4.js","username":null,"timeout":0}},"position":{"x":942.4000000000001,"y":2543.6},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"f1f83d5f-2c23-485e-a715-6102861cb323","code":1,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":"result.length == 1","basicCondition":null,"conditionType":"advanced","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":905,"y":2705},"next":{"yes":{"activity_category":1,"activity":{"cell_id":"7a43926f-db84-4c82-9605-112ee3bb23a1","code":3,"params":{"version":"4.35.0","variable_name":"to_1c_data","variable_value":{"use_previous_step":false,"statement":"result[0]"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":879,"y":2817},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"e4865aa4-46a2-48ac-b3bb-0d67d8174a17","code":3,"params":{"version":"4.35.0","variable_name":"to_1c_access_data","variable_value":{"use_previous_step":false,"statement":"access_data"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":834.9,"y":2934.7999999999997},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"06a8a4e3-b368-48f6-bf16-288f6d36cf24","code":7,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":"data_to_1c.neek","comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":860.1,"y":3065.1999999999994},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"10d44081-2d0b-419f-ac69-16663203ba2e","code":3,"params":{"version":"4.35.0","variable_name":"result","variable_value":{"use_previous_step":false,"statement":"[]"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":878,"y":3157},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"9f16f11f-0c5e-49b9-b89e-16c6e630518a","code":3,"params":{"version":"4.35.0","variable_name":"len","variable_value":{"use_previous_step":false,"statement":"len - 1"},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":"Меняем длинну для проверки условия цикла","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1057,"y":3272},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit"]}}}}}}}}}}},"no":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit","next","no","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit"]}}},"error":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit","next","no","next","exit","next","yes","next","exit","next","exit","next","exit","next","exit"]}}}}}}}}}}}}},"no":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit","next","exit","next","yes","next","exit"]}}}}},"error":{"activity_category":1,"activity":{"cell_id":"72fcba3a-f630-4969-8bc0-996c122048fa","code":7,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":"update_access_data.neek","comment":"Обновление аунтитификационных данных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1081.4,"y":1813.6000000000001},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes"]}}}}},"no":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","yes","next","yes","next","exit"]}}}}}}}}}}}}},"error":{"activity_category":1,"activity":{"cell_id":"de4558a6-a83c-4882-923d-185e9efc87b0","code":3,"params":{"version":"4.35.0","variable_name":"error","variable_value":{"use_previous_step":true},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1231,"y":1001},"next":{"exit":{"activity_category":1,"activity":{"cell_id":"11df50f4-dd40-470c-a151-ba8c124f2cbb","code":3,"params":{"version":"4.35.0","variable_name":"is_next_url","variable_value":{"use_previous_step":false,"statement":"false"},"is_variable_global":true,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":null,"comment":null,"command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1275.4,"y":1086.6},"next":{"exit":{"$type":"ref","value":["start-0","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit","next","exit"]}}}}}}}}}}}}}}},"error":{"activity_category":1,"activity":{"cell_id":"dae8f69c-806f-4d75-9944-01b982105453","code":7,"params":{"version":"4.35.0","variable_name":null,"variable_value":{"value":"","use_previous_step":false},"is_variable_global":false,"condition":null,"basicCondition":null,"conditionType":"basic","delay_ms":0,"delay_sec":{"value":0.25,"use_previous_step":false},"subroutine_path":"update_access_data.neek","comment":"Обновление аунтитификационных данных","command":{"use_previous_step":false},"breakpoint":false,"deactivated":false,"background":false,"log_details":{"use_previous_step":false},"log_message":{"use_previous_step":false},"log_severity":"info","app_title":null,"launch_params":null,"password":null,"iterator_id":null,"iterator_source":{"use_previous_step":false},"fields_map":null,"js_file_path":null,"username":null,"timeout":0}},"position":{"x":1583,"y":322},"next":{"exit":{"$type":"ref","value":["start-0","next","exit"]}}}}}}}}}}}}]